(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{534:function(n,s,e){n.exports=e.p+"assets/img/vpn_keychains.2556b39d.jpg"},535:function(n,s,e){n.exports=e.p+"assets/img/vpn-alfred.e12c24ee.jpg"},536:function(n,s,e){n.exports=e.p+"assets/img/fwvpn_s.4416e6a8.jpg"},628:function(n,s,e){"use strict";e.r(s);var a=e(6),t=Object(a.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("blockquote",[a("p",[n._v("抵抗疫情在家办公，科学上网")])]),n._v(" "),a("p",[n._v("公司的 VPN 需要使用 Cisco Anyconnect 作为客户端来连接，这个客户端在每次连接的时候需都要输入 LDAP 密码来登录。密码很复杂很是麻烦。可以通过 Anyconnect 提供的命令行工具来实现免密登录。经过网上一番搜集，根据\n"),a("a",{attrs:{href:"https://hiberabyss.github.io/2017/11/27/no-password-anyconnect/",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://hiberabyss.github.io/2017/11/27/no-password-anyconnect/"),a("OutboundLink")],1),n._v("整理。")]),n._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[n._v("#")]),n._v(" 安装")]),n._v(" "),a("p",[n._v("安装过程不再赘述， 官网自行查看。 "),a("a",{attrs:{href:"https://software.cisco.com/download/home/286281283/type/282364313/release/4.8.02042?i=!pp",target:"_blank",rel:"noopener noreferrer"}},[n._v("下载地址"),a("OutboundLink")],1)]),n._v(" "),a("h2",{attrs:{id:"通过命令行连接-vpn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过命令行连接-vpn"}},[n._v("#")]),n._v(" 通过命令行连接 VPN")]),n._v(" "),a("p",[n._v("执行命令 "),a("code",[n._v("/opt/cisco/anyconnect/bin/vpn -s")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("$ /opt/cisco/anyconnect/bin/vpn -s\nCisco AnyConnect Secure Mobility Client (version 4.7.01076) .\n\nCopyright (c) 2004 - 2019 Cisco Systems, Inc.  All Rights Reserved.\n\n\n  >> state: Connected\n  >> state: Connected\n  >> registered with local VPN subsystem.\nVPN>\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br")])]),a("p",[n._v("执行"),a("code",[n._v("VPN> connect your.vpn.host:port")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("VPN> connect your.vpn.host:port\nconnect your.vpn.host:port\n  >> state: Connected\n  >> notice: Connected to vpn.ushareit.me.\n  >> contacting host (your.vpn.host:port) for login information...\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("p",[n._v("按照提示输入你的用户名和密码即可连接 VPN .")]),n._v(" "),a("h2",{attrs:{id:"利用脚本连接-vpn-mac-为例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用脚本连接-vpn-mac-为例"}},[n._v("#")]),n._v(" 利用脚本连接 VPN（Mac 为例）")]),n._v(" "),a("p",[n._v("VPN 需要知道三个信息：VPN 地址、用户名和密码。 密码是比较私密的信息，不适合放在脚本文件里，我们可以利用 macOS 里的 Keychain 工具来保存密码。")]),n._v(" "),a("h3",{attrs:{id:"创建一个-keychain-password-item"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个-keychain-password-item"}},[n._v("#")]),n._v(" 创建一个 Keychain password item")]),n._v(" "),a("p",[n._v("打开 Keychain Access 工具，创建一个 VPN_NAME 条目:")]),n._v(" "),a("p",[a("img",{attrs:{src:e(534),alt:""}})]),n._v(" "),a("p",[n._v("当这个条目创建完成，我们便可以利用下面的命令获取密码：")]),n._v(" "),a("p",[a("code",[n._v("security find-generic-password -wl VPN_NAME")])]),n._v(" "),a("h3",{attrs:{id:"创建连接-vpn-的脚本文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建连接-vpn-的脚本文件"}},[n._v("#")]),n._v(" 创建连接 VPN 的脚本文件")]),n._v(" "),a("p",[n._v("下面的 shell 脚本文件会从 Keychain Access 工具里获取 VPN 的密码，然后利用 vpn 命令行工具连接 VPN ，最后打开 Anyconnect 客户端的 UI 界面：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('#!/bin/bash\n\nKEYCHAIN_LABEL="VPN_NAME"\nUSERNAME= "UserName"\nPASSWORD=$(security find-generic-password -wl $KEYCHAIN_LABEL)\nVPN_URL="your.vpn.url"\nVPN_BIN="/opt/cisco/anyconnect/bin/vpn"\nANYCONNECT_PATH="/Applications/Cisco/Cisco AnyConnect Secure Mobility Client.app"\n\nget_anyclient_ui_pid() {\n    local pid=$(ps -ef | grep "$ANYCONNECT_PATH" | grep -v \'grep\' | awk \'{print $2}\')\n    echo $pid\n\n    if [[ -z "$pid" ]]; then\n        return 1\n    else\n        return 0\n    fi\n}\n\nkill_anyconnect_ui() {\n    $VPN_BIN disconnect\n    local pid=$(get_anyclient_ui_pid)\n    # echo "PID: $pid"\n\n    if [[ -n "$pid" ]]; then\n        kill -9 $pid\n    fi\n}\n\nopen_client_ui() {\n    if ! get_anyclient_ui_pid &> /dev/zero; then\n        open "$ANYCONNECT_PATH"\n    fi\n}\n\nconnect() {\n    # sudo /opt/cisco/anyconnect/bin/vpnagentd\n    kill_anyconnect_ui\n\n$VPN_BIN -s << EOF\nconnect $VPN_URL\n$USERNAME\n$PASSWORD\ny\nEOF\n\n    open_client_ui\n}\n\nmain() {\n    if [[ -z "$USERNAME" || -z "$PASSWORD" || -z "$VPN_URL" ]]; then\n        echo "Error: empty user info"\n        exit 1\n    fi\n\n    case "$1" in\n        stop|s )\n            kill_anyconnect_ui\n            ;;\n        * )\n            connect\n    esac\n}\n\nmain "$*"\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br")])]),a("p",[n._v("把上面的内容保存到"),a("code",[n._v("anyconnect")]),n._v("文件中， 给文件加上执行权限 "),a("code",[n._v("chmod +x anyconnect")]),n._v("。现在直接执行 anyconnect 就可以连上 VPN 了。")]),n._v(" "),a("p",[n._v("建议文件路径为: "),a("code",[n._v("$HOME/bin/anyconnect")]),n._v("。（后面结合 Alfred Workflow 优化效率）。")]),n._v(" "),a("p",[n._v("如果有多个 URL，可以在 main 函数里面的 case 语句进行参数过滤，在此对 VPN_URL 赋值。实现连接任意的 VPN URL。")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v(' params )\n    VPN_URL="vpn.url.2"\n    connect\n    ;;\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("$HOME/bin/anyconnect\nCisco AnyConnect Secure Mobility Client (version 4.7.01076) .\n\nCopyright (c) 2004 - 2019 Cisco Systems, Inc.  All Rights Reserved.\n\n\n  >> state: Disconnected\n  >> state: Disconnected\n  >> notice: Ready to connect.\n  >> registered with local VPN subsystem.\n  >> The VPN client is not connected.\n\n\nCisco AnyConnect Secure Mobility Client (version 4.7.01076) .\n\nCopyright (c) 2004 - 2019 Cisco Systems, Inc.  All Rights Reserved.\n\n\n  >> state: Disconnected\n  >> state: Disconnected\n  >> notice: Ready to connect.\n  >> registered with local VPN subsystem.\nVPN> connect your.vpn.url\n  >> contacting host (your.vpn.url) for login information...\n  >> notice: Contacting your.vpn.url.\n\n  >> Please enter your username.\n\nUsername: [your.name] your.name\n\n  >> Please enter your password.\nPassword:\n  >> state: Connecting\n  >> notice: Establishing VPN session...\n  >> notice: The AnyConnect Downloader is performing update checks...\n  >> notice: Checking for profile updates...\n  >> notice: Checking for product updates...\n  >> notice: Checking for customization updates...\n  >> notice: Performing any required updates...\n  >> notice: The AnyConnect Downloader updates have been completed.\n  >> state: Connecting\n  >> notice: Establishing VPN session...\n  >> notice: Establishing VPN - Initiating connection...\n  >> notice: Establishing VPN - Examining system...\n  >> notice: Establishing VPN - Activating VPN adapter...\n  >> notice: Establishing VPN - Configuring system...\n  >> notice: Establishing VPN...\n  >> state: Connected\nVPN>\n[ VPN Connection commands ]\n    connect             disconnect        hosts         stats\n    state               block             cancel\n\n[ Misc commands ]\n    help                version           exit\n\n  For help with a specific command, try: help <command>\n\n  >> notice: Connected to your.vpn.url.\n  >> state: Connected\nVPN> goodbye...\n  >> note: VPN Connection is still active.\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br")])]),a("p",[n._v("VPN 就已经连接成功了。")]),n._v(" "),a("h2",{attrs:{id:"通过-alfred-workflow-插件来连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-alfred-workflow-插件来连接"}},[n._v("#")]),n._v(" 通过 Alfred Workflow 插件来连接")]),n._v(" "),a("p",[n._v("安装这个 "),a("a",{attrs:{href:"https://github.com/hiberabyss/BlogDATA/raw/master/alfred/NoPasswdAnyconnect.alfredworkflow",target:"_blank",rel:"noopener noreferrer"}},[n._v("Alfred Workflow"),a("OutboundLink")],1),n._v(" 即可直接通过 Alfred 来直接打开或者断开 VPN 连接：")]),n._v(" "),a("p",[a("img",{attrs:{src:e(535),alt:""}})]),n._v(" "),a("p",[n._v("没有任何参数时会连接 VPN ，输入参数 s|stop 就会断开 VPN 连接。")]),n._v(" "),a("p",[a("img",{attrs:{src:e(536),alt:""}})])])}),[],!1,null,null,null);s.default=t.exports}}]);